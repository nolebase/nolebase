---
title: ã€è¯‘ã€‘å¦‚ä½•åƒä¸“å®¶ä¸€æ ·ä½¿ç”¨ React Hookï¼šuseReducer
author: ä½œè€… devtrium.com ï¼Œè¯‘è€… Ucely åˆ˜ä¿Š
---

> åŸæ–‡é“¾æ¥ï¼š<https://devtrium.com/posts/how-to-use-react-usereducer-hook>
> 
> ã€ç‰ˆæƒä¿¡æ¯ï¼šè‘—ä½œæƒå½’ devtrium.com æ‰€æœ‰ï¼Œå¦‚éœ€è½¬è½½æœ¬æ–‡ï¼Œè¯·æ³¨æ˜ä½œè€… [devtrium.com](https://devtrium.com) å’Œè¯‘è€… [Ucely åˆ˜ä¿Š](https://Ucely.com)ã€‚ã€‘

## ç®€ä»‹

React çš„ç®¡ç†çŠ¶æ€æ˜¯ä½ åœ¨å¼€å‘ React ç½‘ç«™æ—¶è¦é¢ä¸´çš„ä¸»è¦é—®é¢˜ä¹‹ä¸€ã€‚æ¯«æ— ç–‘é—®ï¼Œ`useState` æ˜¯åœ¨å‡½æ•°å¼ React ç»„ä»¶ä¸­ï¼Œåˆ›å»ºå’Œç®¡ç†çŠ¶æ€çš„æœ€å¸¸è§æ–¹å¼ã€‚

ä¹Ÿæœ‰å¾ˆå¤šåº“æä¾›äº†ç”¨å„è‡ªçš„æ–¹å¼æ¥ç®¡ç†ä½ çš„æ•´ä¸ªï¼ˆæˆ–éƒ¨åˆ†ï¼‰çŠ¶æ€ï¼Œæ¯”å¦‚ [Redux](https://redux.js.org/)ã€[Mobx](https://mobx.js.org/README.html)ã€[Recoil](https://recoiljs.org/) æˆ– [XState](https://xstate.js.org/docs/)ã€‚

ä½†åœ¨è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªåº“æ¥å¸®ä½ ç®¡ç†çŠ¶æ€ä¹‹å‰ï¼Œä½ åº”è¯¥çŸ¥é“å¦ä¸€ç§åœ¨ React ä¸­ç®¡ç†çŠ¶æ€çš„åŸç”Ÿæ–¹æ³•ï¼š`useReducer`ã€‚å½“ä»¥æ­£ç¡®çš„æ–¹å¼å’Œç›®çš„ä½¿ç”¨æ—¶ï¼Œå®ƒå¯ä»¥æ˜¯éå¸¸å¼ºå¤§çš„ã€‚äº‹å®ä¸Šï¼Œå®ƒæ˜¯å¦‚æ­¤å¼ºå¤§ï¼Œä»¥è‡³äºè‘—åçš„ Redux åº“å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¤§çš„ã€ä¼˜åŒ–çš„ `useReducer`ï¼ˆæ–‡æœ«æˆ‘ä»¬ä¼šçœ‹åˆ°çš„ï¼‰ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆè§£é‡Šä»€ä¹ˆæ˜¯ `useReducer` ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒï¼Œç»™ä½ ä¸€ä¸ªå¥½çš„å¿ƒæ™ºæ¨¡å‹å’Œä¾‹å­ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿›è¡Œ `useState` ä¸ `useReducer` çš„æ¯”è¾ƒï¼Œä»¥äº†è§£ä½•æ—¶ä½¿ç”¨å“ªç§æ–¹æ³•ã€‚

å¯¹äº TypeScript ç”¨æˆ·æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜å°†çœ‹åˆ°å¦‚ä½•å°† TypeScript å’Œ `useReducer` ä¸€èµ·ä½¿ç”¨ã€‚

è®©æˆ‘ä»¬å¼€å§‹è¡ŒåŠ¨å§!

## ä»€ä¹ˆæ˜¯ React hook useReducer ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒ

æ­£å¦‚ç®€ä»‹ä¸­æåˆ°çš„ï¼Œ`useState` å’Œ useReducer æ˜¯ React ç®¡ç†çŠ¶æ€çš„ä¸¤ç§æœ¬åœ°æ–¹å¼ã€‚ä½ å¯èƒ½å·²ç»å¯¹å‰è€…ç›¸å½“ç†Ÿæ‚‰äº†ï¼Œæ‰€ä»¥ä»é‚£é‡Œå¼€å§‹ç†è§£ `useReducer` æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚

### useState å’Œ useReducerï¼šä¸€ä¸ªå¿«é€Ÿçš„æ¯”è¾ƒ

ä¹ä¸€çœ‹ï¼Œå®ƒä»¬éå¸¸ç›¸ä¼¼ã€‚è®©æˆ‘ä»¬æ¥æŠŠå®ƒä»¬å¹¶æ’åšä¸€ä¸ªå¯¹æ¯”ã€‚

```js
const [state, setState] = useState(initialValue);

const [state, dispatch] = useReducer(reducer, initialValue);
```

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œ `hook` é’©å­å‡½æ•°éƒ½è¿”å›ä¸€ä¸ªæœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚ç¬¬ä¸€ä¸ªæ˜¯çŠ¶æ€ï¼Œç¬¬äºŒä¸ªæ˜¯è®©ä½ ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ï¼š`setState` ç”¨äº `useState` ï¼Œ`dispatch` ç”¨äº `useReducer`ã€‚æˆ‘ä»¬å°†åœ¨åé¢äº†è§£è°ƒåº¦å™¨ `dispatch` æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

ä¸€ä¸ªåˆå§‹çŠ¶æ€éƒ½åˆ†åˆ«è¢«æä¾›ç»™ `useState` å’Œ `useReducer` ã€‚ é’©å­å‡½æ•°å‚æ•°çš„ä¸»è¦åŒºåˆ«æ˜¯æä¾›ç»™ useReducer çš„è¿˜åŸå™¨ `reducer` ã€‚

è¿™ä¸ª `reducer` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†å¤„ç†çŠ¶æ€åº”è¯¥å¦‚ä½•æ›´æ–°çš„é€»è¾‘ã€‚æˆ‘ä»¬ä¹Ÿä¼šåœ¨æ–‡ç« åé¢è¯¦ç»†äº†è§£å®ƒã€‚

ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ `setState` æˆ– `dispatch` æ¥æ”¹å˜çŠ¶æ€ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªä¹…ç»è€ƒéªŒçš„è®¡æ•°å™¨çš„ä¾‹å­--æˆ‘ä»¬æƒ³åœ¨æŒ‰é’®è¢«ç‚¹å‡»æ—¶å°†å…¶é€’å¢ 1 ï¼š

```js
// ç”¨ `useState`
<button onClick={() => setCount(prevCount => prevCount + 1)}>
  +
</button>

// ç”¨ `useReducer`
<button onClick={() => dispatch({type: 'increment', payload: 1})}>
  +
</button>
```

è™½ç„¶ `useState` ç‰ˆæœ¬å¯èƒ½å¯¹ä½ æ¥è¯´å¾ˆç†Ÿæ‚‰ï¼ˆå¦‚æœä¸æ˜¯ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `setState` çš„å‡½æ•°å¼æ›´æ–°å½¢å¼ï¼‰ï¼Œä½† `useReducer` ç‰ˆæœ¬å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªã€‚

ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¼ é€’ä¸€ä¸ªå¸¦æœ‰ç±»å‹ `type` å’Œæœ‰æ•ˆè½½è· `payload` å±æ€§çš„å¯¹è±¡å‘¢ï¼Ÿé‚£ä¸ªï¼ˆç¥å¥‡çš„ï¼‰å€¼ `increment` æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿåˆ«ç€æ€¥ï¼Œè¿™äº›è°œå›¢ä¼šè¢«ä¸€ä¸€è§£é‡Šçš„ã€‚

ç°åœ¨ï¼Œä½ å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬è¿˜æ˜¯å¾ˆç›¸ä¼¼çš„ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œä½ éƒ½è¦é€šè¿‡è°ƒç”¨æ›´æ–°å‡½æ•°ï¼ˆ `setState` æˆ– `dispatch` ï¼‰æ¥æ›´æ–°çŠ¶æ€ï¼Œå¹¶è¯´æ˜ä½ åˆ°åº•è¦å¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚

ç°åœ¨è®©æˆ‘ä»¬åœ¨é«˜å±‚æ¬¡ä¸Šæ¢è®¨ä¸€ä¸‹ `useReducer` ç‰ˆæœ¬åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

### useReducerï¼šä¸€ä¸ªåç«¯çš„å¿ƒæ™ºæ¨¡å‹

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘æƒ³è®©ä½ å¯¹ `useReducer` é’©å­å‡½æ•° hook æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå»ºç«‹ä¸€ä¸ªè‰¯å¥½çš„å¿ƒæ™ºæ¨¡å‹ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå½“æˆ‘ä»¬æ·±é™·äºå®ç°çœŸæ­£é—®é¢˜çš„ç»†èŠ‚ä¹‹ä¸­æ—¶ï¼Œäº‹æƒ…å¯èƒ½ä¼šå˜å¾—æœ‰ç‚¹ä»¤äººä¸çŸ¥æ‰€æªã€‚ç‰¹åˆ«æ˜¯å¦‚æœä½ ä»¥å‰ä»æœªæ¥è§¦è¿‡ç±»ä¼¼çš„ç»“æ„çš„æ—¶å€™ã€‚

æ€è€ƒ `useReducer` çš„ä¸€ç§æ–¹å¼æ˜¯æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªåç«¯ã€‚è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹å¥‡æ€ªï¼Œä½†è¯·å®¹å¿æˆ‘ä¸€ä¸‹ >_<ã€‚æˆ‘å¯¹è¿™ä¸ªæ¯”å–»éå¸¸æ»¡æ„ï¼Œæˆ‘è®¤ä¸ºå®ƒå¾ˆå¥½åœ°è§£é‡Šäº†ä»€ä¹ˆæ˜¯ `reducer` ï¼ˆè§„çº¦å‡½æ•°/ç®€åŒ–å‡½æ•°ï¼‰ã€‚

åå°çš„ç»“æ„é€šå¸¸æ˜¯ç”¨æŸç§æ–¹å¼æ¥ä¿å­˜æ•°æ®ï¼ˆæ•°æ®åº“ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªè®©ä½ ä¿®æ”¹æ•°æ®åº“çš„APIã€‚

è¯¥ API ä¼šæä¾› HTTP æ¥å£è®©ä½ è°ƒç”¨ã€‚GET è¯·æ±‚è®©ä½ è®¿é—®æ•°æ®ï¼Œè€Œ POST è¯·æ±‚è®©ä½ ä¿®æ”¹æ•°æ®ã€‚å½“ä½ åš POST è¯·æ±‚æ—¶ï¼Œä½ æˆ–è®¸å¯ä»¥ä¼ å…¥ä¸€äº›å‚æ•°ï¼›ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ï¼Œä½ é€šå¸¸ä¼šåœ¨ HTTP POST è¯·æ±‚ä¸­åŒ…æ‹¬æ–°ç”¨æˆ·çš„ç”¨æˆ·åã€ç”µå­é‚®ä»¶å’Œå¯†ç ã€‚

é‚£ä¹ˆï¼ŒuseReducerä¸åç«¯æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿè¯·çœ‹ï¼š

- çŠ¶æ€ `state` ç›¸å½“äºæ˜¯æ•°æ®åº“ã€‚å®ƒå­˜å‚¨ç€ä½ çš„æ•°æ®ï¼›
- `dispatch` ç›¸å½“äºè°ƒç”¨ API æ¥å£æ¥ä¿®æ”¹æ•°æ®åº“ï¼›
  - ä½ å¯ä»¥é€šè¿‡æŒ‡å®šè°ƒç”¨çš„ç±»å‹ `type` æ¥é€‰æ‹©è°ƒç”¨å“ªä¸ªæ¥å£ï¼›
  - ä½ å¯ä»¥ç”¨ `payload` å±æ€§æä¾›é¢å¤–çš„æ•°æ®ï¼Œå®ƒå¯¹åº”äº POST è¯·æ±‚çš„è¯·æ±‚ä½“ `body`ï¼›
  - `type` å’Œ `payload` éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œè¿™ä¸ªå¯¹è±¡è¢«äº¤ç»™äº† `reducer`ã€‚è¿™ä¸ªå¯¹è±¡è¢«ç§°ä¸º `action`ï¼›
- `reducer` å‡½æ•°æ˜¯ API çš„é€»è¾‘å¤„ç†å‡½æ•°ã€‚å½“åç«¯æ”¶åˆ°ä¸€ä¸ª API è°ƒç”¨ï¼ˆ`dispatch` è°ƒç”¨ï¼‰æ—¶ï¼Œå®ƒä¼šè¢«æ‰§è¡Œï¼Œå¹¶å¤„ç†å¦‚ä½•åŸºäºæ¥å£å’Œè¯·æ±‚å†…å®¹ï¼ˆå³åŠ¨ä½œ `action`ï¼‰æ¥æ›´æ–°æ•°æ®åº“ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ `useReducer` ä½¿ç”¨ä¾‹å­ã€‚èŠ±ç‚¹æ—¶é—´æ¥æ¥å—å®ƒï¼Œå¹¶å°†å®ƒä¸ä¸Šé¢æè¿°çš„åç«¯å¿ƒæ™ºæ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚

```jsx
import { useReducer } from 'react';

// æ•°æ®åº“çš„åˆå§‹çŠ¶æ€
const initialState = { count: 0 };

// API é€»è¾‘: å½“ API æ¥å£ 'increment' è¢«è°ƒç”¨æ—¶ï¼Œå¦‚ä½•æ›´æ–°æ•°æ®åº“
const reducer = (state, action) => {
  if (action.type === 'increment') {
    return { count: state.count + action.payload };
  }
};

function App() {
  // ä½ å¯ä»¥æŠŠè¿™æ­¥å½“ä½œæ˜¯åˆå§‹åŒ–ï¼Œå¹¶äºåç«¯å»ºç«‹è¿æ¥
  const [state, dispatch] = useReducer(reducer, initialState);

  return (
    <div>
      {/* ä»æ•°æ®åº“è¯»å–æ•°æ® */}
      Count: {state.count}
      {/* åœ¨æŒ‰é’®è¢«ç‚¹å‡»çš„æ—¶å€™è°ƒç”¨ API */}
      <button onClick={() => dispatch({ type: 'increment', payload: 1 })}>
        +
      </button>
    </div>
  );
}

export default App;
```

ä½ èƒ½çœ‹å‡ºè¿™ä¸¤è€…æœ‰ä»€ä¹ˆå…³ç³»å—ï¼Ÿ

è®°ä½ï¼Œä¸Šé¢çš„ä»£ç ä¸åº”è¯¥åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªæœ€å°ç‰ˆæœ¬çš„useReduceré’©å­ï¼Œä»¥å¸®åŠ©ä½ å°†å…¶ä¸åç«¯å¿ƒæ™ºæ¨¡å‹è¿›è¡Œæ¯”è¾ƒï¼Œä½†å®ƒç¼ºå°‘å‡ ä¸ªé‡è¦çš„ä¸œè¥¿ï¼Œä½ å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­äº†è§£åˆ°ã€‚

ç°åœ¨ï¼Œï¼ˆå¸Œæœ›ï¼‰ä½ å¯¹useReduceræ˜¯å¦‚ä½•åœ¨é«˜å±‚æ¬¡ä¸Šå·¥ä½œçš„æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„æ¦‚å¿µï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥æ¢ç´¢ç»†èŠ‚ã€‚

### Reducer æ˜¯å¦‚ä½•å·¥ä½œçš„

æˆ‘ä»¬å°†é¦–å…ˆè§£å†³ `reducer` çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒæ˜¯ä¸»è¦é€»è¾‘å‘ç”Ÿçš„åœ°æ–¹ã€‚

æ­£å¦‚ä½ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æ³¨æ„åˆ°çš„ï¼Œ`reducer` æ˜¯ä¸€ä¸ªéœ€è¦ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯å½“å‰çŠ¶æ€ `state` ï¼Œç¬¬äºŒä¸ªæ˜¯åŠ¨ä½œ `action`ï¼ˆåœ¨æˆ‘ä»¬çš„åç«¯ç±»æ¯”ä¸­ï¼Œå®ƒå¯¹åº”äºAPIæ¥å£ + ä»»ä½•è¯·æ±‚çš„ä¸»ä½“ï¼‰ã€‚

è¯·è®°ä½ï¼Œä½ ä¸éœ€è¦è‡ªå·±æä¾›å‚æ•°ç»™ `reducer` ã€‚è¿™ç”± `useReducer` é’©å­è‡ªåŠ¨å¤„ç†ï¼šçŠ¶æ€æ˜¯å·²çŸ¥çš„ï¼Œè€ŒåŠ¨ä½œåªæ˜¯ `dispatch` çš„å‚æ•°ï¼Œå®ƒè¢«ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ `reducer` ã€‚

çŠ¶æ€æœ‰ä½ æƒ³è¦çš„ä»»ä½•æ ¼å¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†å®ƒçœŸçš„å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼‰ã€‚åŠ¨ä½œä¹Ÿå¯ä»¥æ˜¯ä½ æƒ³è¦çš„ä»»ä½•ä¸œè¥¿ï¼Œä½†æœ‰ä¸€äº›éå¸¸å¸¸ç”¨çš„çº¦å®šï¼Œå³å¦‚ä½•æ„é€ å®ƒï¼Œæˆ‘å»ºè®®ä½ éµå¾ªè¿™äº›çº¦å®šâ€”â€”æˆ‘ä»¬å°†åœ¨åé¢å­¦ä¹ å®ƒä»¬ã€‚è‡³å°‘æ˜¯åœ¨ä½ ç†Ÿæ‚‰äº†è¿™äº›æƒ¯ä¾‹ã€å¹¶ç¡®å®šä¸éµå®ˆè¿™äº›æƒ¯ä¾‹æ˜¯ä½ çœŸæ­£æƒ³è¦çš„ä¹‹å‰ã€‚

æ‰€ä»¥æŒ‰ç…§æƒ¯ä¾‹ï¼ŒåŠ¨ä½œ `action` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ä¸€ä¸ªå¿…éœ€çš„å±æ€§å’Œä¸€ä¸ªå¯é€‰çš„å±æ€§ï¼š

- `type` æ˜¯å¿…éœ€çš„å±æ€§ï¼ˆç±»ä¼¼äº API çš„æ¥å£åç§°ï¼‰ã€‚å®ƒå‘Šè¯‰ `reducer` åº”è¯¥ä½¿ç”¨å“ªå—é€»è¾‘æ¥ä¿®æ”¹çŠ¶æ€ã€‚
- `payload` æ˜¯å¯é€‰å±æ€§ï¼ˆç±»ä¼¼äºHTTP POSTè¯·æ±‚çš„ä¸»ä½“ï¼Œå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å®ƒå‘ `reducer` æä¾›äº†å…³äºå¦‚ä½•ä¿®æ”¹çŠ¶æ€çš„é¢å¤–ä¿¡æ¯ã€‚

åœ¨æˆ‘ä»¬ä¹‹å‰çš„è®¡æ•°å™¨çš„ä¾‹å­ä¸­ï¼ŒçŠ¶æ€æ˜¯ä¸€ä¸ªå…·æœ‰å•ä¸€è®¡æ•° `count` å±æ€§çš„å¯¹è±¡ã€‚åŠ¨ä½œ `action` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ç±»å‹ `type` å¯ä»¥æ˜¯ â€œå¢åŠ â€ `increment` ï¼Œå…¶æœ‰æ•ˆè½½è· `payload` æ˜¯ä½ æƒ³è¦ç»™è®¡æ•°å™¨çš„åŠ çš„æ•°ã€‚

```js
// è¿™ä¸ªä¸€ä¸ª `state` çŠ¶æ€çš„ä¾‹å­
const state = { count: 0 };

// è¿™æ˜¯ä¸€ä¸ª `action` åŠ¨ä½œçš„ä¾‹å­
const action = { type: 'increment', payload: 2 };
```

ä¾‹å¦‚ï¼Œ`reducer` å‡½æ•°ç»“æ„ä¸­é€šå¸¸æœ‰ä¸€ä¸ªå…³äº `action` ç±»å‹çš„ `switch` è¯­å¥ã€‚

```js
const reducer = (state, action) => {
  switch (action.type) {
    case 'increment':
      return { count: state.count + action.payload };
    case 'decrement':
      return { count: state.count - action.payload };
    case 'reset':
      return { count: 0 };
  }
};
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`reducer` æ¥å—ä¸‰ç§åŠ¨ä½œç±»å‹ã€‚å¢åŠ  `increment`ã€å‡å°‘ `decrement` å’Œ é‡ç½® `reset`ã€‚å¢åŠ å’Œå‡å°‘éƒ½éœ€è¦ä¸€ä¸ª`action` çš„ `payload` ï¼Œå®ƒå°†å†³å®šè®¡æ•°å™¨å¢åŠ æˆ–å‡å°‘çš„æ•°é‡ã€‚ç›¸åï¼Œ`reset` ç±»å‹ä¸éœ€è¦ä»»ä½•æœ‰æ•ˆè½½è·ï¼Œå› ä¸ºå®ƒæŠŠè®¡æ•°å™¨é‡ç½®ä¸º0ã€‚

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼Œè€Œç°å®ç”Ÿæ´»ä¸­çš„è¿˜åŸå™¨é€šå¸¸è¦å¤§å¾—å¤šï¼Œä¹Ÿå¤æ‚å¾—å¤šã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„ç« èŠ‚ä¸­çœ‹åˆ°å¦‚ä½•æ”¹è¿›æˆ‘ä»¬ç¼–å†™ `reducer` çš„æ–¹æ³•ï¼Œä»¥åŠç°å®ç”Ÿæ´»ä¸­çš„åº”ç”¨ç¨‹åºä¸­çš„ `reducer` çš„ä¾‹å­ã€‚

### dispatch æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

å¦‚æœä½ å·²ç»ç†è§£äº† `reducer` çš„å·¥ä½œåŸç†ï¼Œé‚£ä¹ˆç†è§£ `dispatch` ï¼ˆè°ƒåº¦å‡½æ•°ï¼‰å°±éå¸¸ç®€å•äº†ã€‚

å½“ä½ è°ƒç”¨ `dispatch` æ—¶ï¼Œæ— è®ºç»™å®ƒçš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œéƒ½å°†æ˜¯ç»™ä½ çš„ `reducer` å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•° `action` ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªå…·æœ‰ç±»å‹ `type` å’Œ `payload` ï¼ˆå¯é€‰ï¼‰çš„å¯¹è±¡ Object ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚çœ‹åˆ°çš„é‚£æ ·ã€‚

ä½¿ç”¨æˆ‘ä»¬ä¸Šä¸€ä¸ª `reducer` çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åšä¸€ä¸ªæŒ‰é’®ï¼Œåœ¨ç‚¹å‡»æ—¶å°†è®¡æ•°å™¨å‡å°‘2ï¼Œå®ƒå°†çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```js
<button onClick={() => dispatch({ type: 'decrement', payload: 2 })}>-</button>
```

å¦‚æœæˆ‘ä»¬æƒ³æœ‰ä¸€ä¸ªå°†è®¡æ•°å™¨é‡ç½®ä¸º0çš„æŒ‰é’®ï¼Œä»ç„¶ä½¿ç”¨æˆ‘ä»¬ä¸Šä¸€ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥çœç•¥ `payload`ï¼š

```jsx
<button onClick={() => dispatch({ type: 'reset' })}>reset</button>
```

å…³äº `dispatch` ï¼Œéœ€è¦æ³¨æ„çš„ä¸€ä»¶äº‹æ˜¯ React ä¿è¯å®ƒçš„å€¼å’Œå†…å­˜æŒ‡å‘ï¼Œä¸ä¼šåœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ã€‚è¿™æ„å‘³ç€ä½ ä¸éœ€è¦æŠŠå®ƒæ”¾åœ¨ä¾èµ–æ€§æ•°ç»„ä¸­ï¼ˆå¦‚æœä½ è¿™æ ·åšï¼Œå®ƒæ°¸è¿œä¸ä¼šè§¦å‘ä¾èµ–æ€§æ•°ç»„ï¼‰ã€‚è¿™ä¸ `useState` çš„ `setState` å‡½æ•°çš„è¡Œä¸ºç›¸åŒã€‚

::: tip
å¦‚æœä½ å¯¹æœ€åä¸€æ®µè¯æœ‰ç‚¹æ¨¡ç³Šï¼Œæˆ‘å·²ç»ç”¨è¿™ç¯‡[å…³äºä¾èµ–æ•°ç»„çš„æ–‡ç« ](https://devtrium.com/posts/dependency-arrays)ä¸ºä½ åšäº†ä»‹ç»ã€‚
:::

### useReducer åˆå§‹çŠ¶æ€

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ç»å¸¸æåˆ°å®ƒï¼Œä½†æ˜¯ `useReducer` ä¹Ÿéœ€è¦ä¸€ä¸ªç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™æ˜¯ä½ æƒ³ç»™çŠ¶æ€çš„åˆå§‹å€¼ã€‚

å®ƒæœ¬èº«ä¸æ˜¯ä¸€ä¸ªå¿…é¡»çš„å‚æ•°ï¼Œä½†æ˜¯å¦‚æœä½ ä¸æä¾›å®ƒï¼ŒçŠ¶æ€ä¸€å¼€å§‹å°±ä¼šæ˜¯ `undefined` ï¼Œè¿™å¾ˆå°‘æ˜¯ä½ æƒ³è¦çš„ã€‚

ä½ é€šå¸¸åœ¨åˆå§‹çŠ¶æ€ä¸­å®šä¹‰è¿˜åŸå™¨çŠ¶æ€çš„å®Œæ•´ç»“æ„ã€‚å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½ ä¸åº”è¯¥åœ¨ä½ çš„è¿˜åŸå™¨ä¸­ä¸ºè¯¥å¯¹è±¡æ·»åŠ æ–°çš„å±æ€§ã€‚

åœ¨æˆ‘ä»¬çš„è®¡æ•°å™¨ä¾‹å­ä¸­ï¼Œåˆå§‹çŠ¶æ€æ˜¯ç®€å•çš„ã€‚

```js
// æ•°æ®åº“çš„åˆå§‹çŠ¶æ€
const initialState = { count: 0 };
Â· Â· Â·

// åœ¨ç»„ä»¶å†…ä½¿ç”¨
const [state, dispatch] = useReducer(reducer, initialState);
```

æˆ‘ä»¬å°†è¿›ä¸€æ­¥çœ‹åˆ°æ›´å¤šè¿™æ ·çš„ä¾‹å­ã€‚

### useReducerçš„æŠ€å·§å’Œçªé—¨

æˆ‘ä»¬æœ‰å‡ ç§æ–¹æ³•å¯ä»¥æ”¹è¿›æˆ‘ä»¬å¯¹ `useReducer` çš„ä½¿ç”¨ã€‚å…¶ä¸­ä¸€äº›æ˜¯ä½ çœŸæ­£åº”è¯¥åšçš„äº‹æƒ…ï¼Œå…¶ä»–çš„åˆ™æ›´å¤šåœ°æ˜¯ä¸ªäººå“å‘³çš„é—®é¢˜ã€‚

æˆ‘æŠŠå®ƒä»¬ä»é‡è¦çš„åˆ°å¯é€‰çš„è¿›è¡Œäº†ç²—ç•¥çš„åˆ†ç±»ï¼Œä»æœ€é‡è¦çš„å¼€å§‹ã€‚

#### å¯¹äºæœªçŸ¥çš„åŠ¨ä½œç±»å‹ï¼Œè¿˜åŸå™¨åº”è¯¥æŠ›å‡ºä¸€ä¸ªé”™è¯¯

åœ¨æˆ‘ä»¬çš„è®¡æ•°å™¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰ä¸‰ç§æƒ…å†µçš„ `switch` è¯­å¥ã€‚å¢åŠ ã€å‡å°‘å’Œé‡ç½®ã€‚å¦‚æœä½ çœŸçš„æŠŠè¿™ä¸ªå†™è¿›äº†ä½ çš„ä»£ç ç¼–è¾‘å™¨ï¼Œä½ å¯èƒ½ä¼šå‘ç° ESLint ä¼šå¯¹ä½ å¾ˆç”Ÿæ°” >_--_< ã€‚

::: tip
ä½ æœ‰ [ESLint](https://eslint.org/) å§ï¼Ÿå¦‚æœä½ æ²¡æœ‰ï¼Œä½ çœŸçš„åº”è¯¥æŠŠå®ƒè®¾ç½®å¥½!
:::

ESLintï¼ˆæ­£ç¡®åœ°ï¼‰å¸Œæœ›switchè¯­å¥æœ‰ä¸€ä¸ªé»˜è®¤çš„æ¡ˆä¾‹ã€‚é‚£ä¹ˆï¼Œå½“reduceråœ¨å¤„ç†ä¸€ä¸ªæœªçŸ¥çš„åŠ¨ä½œç±»å‹æ—¶ï¼Œå®ƒçš„é»˜è®¤æƒ…å†µåº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ

æœ‰äº›äººå–œæ¬¢ç®€å•åœ°è¿”å›çŠ¶æ€ã€‚

```js
const reducer = (state, action) => {
  switch (action.type) {
    case 'increment':
      return { count: state.count + action.payload };
    case 'decrement':
      return { count: state.count - action.payload };
    case 'reset':
      return { count: 0 };
    default:
      return state;
  }
};
```

ä½†æˆ‘çœŸçš„ä¸å–œæ¬¢è¿™æ ·ã€‚è¦ä¹ˆ `action` ç±»å‹æ˜¯ä½ æ‰€æœŸæœ›çš„ï¼Œå¹¶ä¸”åº”è¯¥æœ‰ä¸€ä¸ªæ¡ˆä¾‹ï¼Œè¦ä¹ˆä¸æ˜¯ï¼Œé‚£ä¹ˆè¿”å›çŠ¶æ€ä¹Ÿä¸æ˜¯ä½ æƒ³è¦çš„ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯åœ¨æä¾›ä¸æ­£ç¡®çš„åŠ¨ä½œç±»å‹æ—¶äº§ç”Ÿä¸€ä¸ª[â€œå®‰é™çš„é”™è¯¯â€](https://en.wikipedia.org/wiki/Error_hiding)ï¼Œè€Œâ€œå®‰é™çš„é”™è¯¯â€æ˜¯å¾ˆéš¾è°ƒè¯•çš„ã€‚

ç›¸åï¼Œä½ çš„é»˜è®¤ `reducer` æ¡ˆä¾‹åº”è¯¥æ˜¯æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

```js
const reducer = (state, action) => {
  switch (action.type) {
    case 'increment':
      return { count: state.count + action.payload };
    case 'decrement':
      return { count: state.count - action.payload };
    case 'reset':
      return { count: 0 };
    default:
      throw new Error(`Unknown action type: ${action.type}`);
  }
};

```

è¿™æ ·ï¼Œä½ å°±ä¸ä¼šæ¼æ‰ä¸€ä¸ªé”™å­—æˆ–å¿˜è®°ä¸€ä¸ªæ¡ˆä¾‹ã€‚

#### ä½ åº”è¯¥åœ¨æ¯ä¸ªåŠ¨ä½œä¸­ä¼ æ’­çŠ¶æ€

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªçœ‹åˆ°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ `useReducer` ä¾‹å­ï¼Œå…¶ä¸­çš„çŠ¶æ€æ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå±æ€§çš„å¯¹è±¡ã€‚ä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œ`useReducer` ç”¨ä¾‹è¦æ±‚çŠ¶æ€å¯¹è±¡è‡³å°‘è¦æœ‰å‡ ä¸ªå±æ€§ã€‚

ä¸€ä¸ªå¸¸è§çš„ `useReducer` ç”¨æ³•æ˜¯å¤„ç†è¡¨å•ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªè¾“å…¥å­—æ®µçš„ä¾‹å­ï¼Œä½†ä½ å¯ä»¥æƒ³è±¡æœ‰æ›´å¤šå­—æ®µçš„æƒ…å†µã€‚

(æ³¨æ„ï¼ä¸‹é¢çš„ä»£ç æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œä½ èƒ½å‘ç°å—ï¼Ÿ)

```js
import { useReducer } from 'react';

const initialValue = {
  username: '',
  email: '',
};

const reducer = (state, action) => {
  switch (action.type) {
    case 'username':
      return { username: action.payload };
    case 'email':
      return { email: action.payload };
    default:
      throw new Error(`Unknown action type: ${action.type}`);
  }
};

const Form = () => {
  const [state, dispatch] = useReducer(reducer, initialValue);
  return (
    <div>
      <input
        type="text"
        value={state.username}
        onChange={(event) =>
          dispatch({ type: 'username', payload: event.target.value })
        }
      />
      <input
        type="email"
        value={state.email}
        onChange={(event) =>
          dispatch({ type: 'email', payload: event.target.value })
        }
      />
    </div>
  );
};

export default Form;
```

é—®é¢˜å‡ºåœ¨ `reducer` ä¸Šï¼šæ›´æ–°ç”¨æˆ·å `username` ä¼šå®Œå…¨è¦†ç›–ä¹‹å‰çš„çŠ¶æ€å¹¶åˆ é™¤ç”µå­é‚®ä»¶ `email`ï¼ˆè€Œæ›´æ–°ç”µå­é‚®ä»¶ `email` ä¹Ÿä¼šå¯¹ç”¨æˆ·å `username` åšåŒæ ·çš„å¤„ç†ï¼‰ã€‚

è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ï¼Œæ¯æ¬¡æ›´æ–°ä¸€ä¸ªå±æ€§æ—¶ï¼Œè¦è®°å¾—ä¿ç•™æ‰€æœ‰ä»¥å‰çš„çŠ¶æ€ã€‚è¿™å¯ä»¥é€šè¿‡[ä¼ æ’­è¯­æ³•](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax)è½»æ¾å®ç°ã€‚

```jsx
import { useReducer } from 'react';

const initialValue = {
  username: '',
  email: '',
};

const reducer = (state, action) => {
  switch (action.type) {
    case 'username':
      return { ...state, username: action.payload };
    case 'email':
      return { ...state, email: action.payload };
    default:
      throw new Error(`Unknown action type: ${action.type}`);
  }
};

const Form = () => {
  const [state, dispatch] = useReducer(reducer, initialValue);
  return (
    <div>
      <input
        value={state.username}
        onChange={(event) =>
          dispatch({ type: 'username', payload: event.target.value })
        }
      />
      <input
        value={state.email}
        onChange={(event) =>
          dispatch({ type: 'email', payload: event.target.value })
        }
      />
    </div>
  );
};

export default Form;
```

è¿™ä¸ªä¾‹å­å®é™…ä¸Šè¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬åœ¨ `reducer` ä¸­æœ‰äº›é‡å¤ï¼šç”¨æˆ·å `username` å’Œç”µå­é‚®ä»¶ `email` çš„æƒ…å†µåŸºæœ¬ä¸Šéƒ½æ˜¯åŒæ ·çš„é€»è¾‘ã€‚è¿™å¯¹äºä¸¤ä¸ªå­—æ®µæ¥è¯´è¿˜ä¸ç®—å¤ªåï¼Œä½†æˆ‘ä»¬å¦‚æœæœ‰æ›´å¤šçš„å­—æ®µï¼Œä¸åŠ ä»¥ä¼˜åŒ–ï¼Œä»£ç å°±ä¼šå˜å¾—åºå¤§è€Œå†—ä½™ã€‚

æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥é‡æ„ä»£ç ï¼Œè®©æ‰€æœ‰çš„è¾“å…¥éƒ½åªæœ‰ä¸€ä¸ªåŠ¨ä½œï¼Œä½¿ç”¨ [`ES2015` çš„è®¡ç®—é”® `key` çš„ç‰¹æ€§](https://stackoverflow.com/a/19837961/3352975)ã€‚

```jsx
import { useReducer } from 'react';

const initialValue = {
  username: '',
  email: '',
};

const reducer = (state, action) => {
  switch (action.type) {
    case 'textInput':
      return {
        ...state,
        [action.payload.key]: action.payload.value,
      };
    default:
      throw new Error(`Unknown action type: ${action.type}`);
  }
};

const Form = () => {
  const [state, dispatch] = useReducer(reducer, initialValue);
  return (
    <div>
      <input
        value={state.username}
        onChange={(event) =>
          dispatch({
            type: 'textInput',
            payload: { key: 'username', value: event.target.value },
          })
        }
      />
      <input
        value={state.email}
        onChange={(event) =>
          dispatch({
            type: 'textInput',
            payload: { key: 'email', value: event.target.value },
          })
        }
      />
    </div>
  );
};

export default Form;
```

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬ç°åœ¨åªå‰©ä¸‹ä¸€ä¸ªåŠ¨ä½œç±»å‹ï¼š`textInput` ã€‚åŠ¨ä½œçš„æœ‰æ•ˆè½½è· `payload` ä¹Ÿå‘ç”Ÿäº†å˜åŒ–â€”â€”å®ƒå˜æˆäº†ä¸€ä¸ªæœ‰é”®ï¼ˆè¦æ›´æ–°çš„å±æ€§ï¼‰å’Œå€¼ï¼ˆæ›´æ–°é”®çš„å€¼ï¼‰çš„å¯¹è±¡ã€‚

è¦æˆ‘è¯´ï¼Œè¿™ç§æ–¹æ¡ˆå¾ˆä¸é”™ QaQã€‚

::: tip
ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹åœ¨é‡å¤è‡ªå·±ï¼š`onChange` äº‹ä»¶å¤„ç†ç¨‹åºã€‚å”¯ä¸€æ”¹å˜çš„æ˜¯ `payload.key`ã€‚
äº‹å®ä¸Šï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥å°†å…¶æå–ä¸ºä¸€ä¸ªå¯é‡å¤ä½¿ç”¨çš„åŠ¨ä½œï¼Œä½ åªéœ€è¦æä¾› `key` ã€‚
æˆ‘å€¾å‘äºåªåœ¨è¿˜åŸå™¨å¼€å§‹å˜å¾—éå¸¸å¤§çš„æ—¶å€™ï¼Œæˆ–è€…åœ¨éå¸¸ç›¸ä¼¼çš„åŠ¨ä½œç»å¸¸è¢«é‡å¤çš„æ—¶å€™ï¼Œæ‰ä½¿ç”¨å¯é‡ç”¨çš„åŠ¨ä½œã€‚
ä½†è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„æ¨¡å¼ï¼Œæˆ‘ä»¬å°†åœ¨æ–‡ç« åé¢å±•ç¤ºä¸€ä¸ªä¾‹å­ã€‚
:::

#### åšæŒä¼ ç»Ÿçš„åŠ¨ä½œ `action` ç»“æ„

æˆ‘è¯´çš„ä¼ ç»Ÿçš„ `action` ç»“æ„æ˜¯æŒ‡æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä¸€ç›´ä½¿ç”¨çš„ç»“æ„ï¼šåŠ¨ä½œåº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå½¢å¼ä¸Šçœ‹æœ‰ä¸€ä¸ªå¿…éœ€çš„ `type` å’Œä¸€ä¸ªå¯é€‰çš„ `payload` ã€‚

è¿™æ˜¯ `Redux` çš„åŠ¨ä½œç»“æ„æ–¹å¼ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ã€‚å®ƒæ˜¯ä¹…ç»è€ƒéªŒçš„ï¼Œå¯¹ä½ æ‰€æœ‰çš„ useReducers æ¥è¯´æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é»˜è®¤é€‰æ‹©ã€‚

è¿™ç§ç»“æ„çš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œå®ƒæœ‰æ—¶ä¼šæœ‰ç‚¹å†—é•¿ã€‚ä½†é™¤éä½ å¯¹useReduceréå¸¸ç†Ÿæ‚‰ï¼Œå¦åˆ™æˆ‘å»ºè®®ä½ åšæŒä½¿ç”¨Reduxçš„æ–¹å¼ã€‚

### è¯­æ³•ç³–ğŸ¬ï¼šä»åŠ¨ä½œä¸­è§£æ„ç±»å‹å’Œæœ‰æ•ˆè½½è·

è¿™æ˜¯ä¸€ä¸ªæé«˜ä»£ç ä½“éªŒçš„é—®é¢˜ã€‚ä¸å…¶åœ¨ä½ çš„ `reducer` ä¸­åˆ°å¤„é‡å¤ `action.payload`ï¼ˆä»¥åŠæ½œåœ¨çš„ `action.type` ï¼‰ï¼Œä½ å¯ä»¥ç›´æ¥è§£æ„ `reducer` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œåƒè¿™æ ·ï¼š

```js
const reducer = (state, { type, payload }) => {
  switch (type) {
    case 'increment':
      return { count: state.count + payload };
    case 'decrement':
      return { count: state.count - payload };
    case 'reset':
      return { count: 0 };
    default:
      throw new Error(`Unknown action type: ${type}`);
  }
};
```

ä½ ç”šè‡³å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œä¹Ÿå¯ä»¥å¯¹çŠ¶æ€ `action` è¿›è¡Œè§£æ„ã€‚è¿™åªæœ‰åœ¨ä½ çš„ `reducer` çš„ çŠ¶æ€ `state` è¶³å¤Ÿå°çš„æƒ…å†µä¸‹æ‰æ–¹ä¾¿ï¼Œä½†åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå®ƒä¹Ÿæ˜¯ä¸é”™çš„ã€‚

```js
const reducer = ({ count }, { type, payload }) => {
  switch (type) {
    case 'increment':
      return { count: count + payload };
    case 'decrement':
      return { count: count - payload };
    case 'reset':
      return { count: 0 };
    default:
      throw new Error(`Unknown action type: ${type}`);
  }
};
```

æŠ€å·§å’Œçªé—¨å°±åˆ°æ­¤ä¸ºæ­¢!

### useReducerç¬¬ä¸‰ä¸ªå‚æ•°ï¼šåˆå§‹åŒ–æ‡’åŠ è½½

å¾ˆé«˜å…´çŸ¥é“useReduceræœ‰ä¸€ä¸ªå¯é€‰çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç”¨äºæ‡’æƒ°åœ°ï¼ˆæ»ååœ°ï¼‰åˆå§‹åŒ–çŠ¶æ€çš„å‡½æ•°ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ã€‚

è¿™å¹¶ä¸ç»å¸¸ä½¿ç”¨ï¼Œä½†å½“ä½ çœŸæ­£éœ€è¦å®ƒæ—¶ï¼Œå®ƒå¯èƒ½ç›¸å½“æœ‰ç”¨ã€‚Reactæ–‡æ¡£ä¸­æœ‰[ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­](https://reactjs.org/docs/hooks-reference.html#lazy-initialization)ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™ç§æ‡’æƒ°çš„åˆå§‹åŒ–ã€‚

## useState vs useReducerï¼šä½•æ—¶ä½¿ç”¨å“ªç§æ–¹æ³•

ç°åœ¨ä½ çŸ¥é“äº† `useReducer` çš„å·¥ä½œåŸç†ä»¥åŠå¦‚ä½•åœ¨ä½ çš„ç»„ä»¶ä¸­ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬éœ€è¦è§£å†³ä¸€ä¸ªé‡è¦é—®é¢˜ã€‚æ—¢ç„¶ `useState` å’Œ`useReducer` æ˜¯ä¸¤ç§ç®¡ç†çŠ¶æ€çš„æ–¹å¼ï¼Œé‚£ä¹ˆä½ åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™é€‰æ‹©å“ªä¸€ç§å‘¢ï¼Ÿ

è¿™ç±»é—®é¢˜æ€»æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„è¯é¢˜ï¼Œå› ä¸ºç­”æ¡ˆé€šå¸¸ä¼šæ ¹æ®ä½ é—®çš„äººè€Œæ”¹å˜ï¼Œè€Œä¸”å®ƒä¹Ÿæ˜¯é«˜åº¦ä¾èµ–äºä¸Šä¸‹æ–‡çš„ã€‚ç„¶è€Œï¼Œä»ç„¶æœ‰ä¸€äº›å‡†åˆ™å¯ä»¥æŒ‡å¯¼ä½ çš„é€‰æ‹©ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ useState ä»ç„¶åº”è¯¥æ˜¯ä½ ç®¡ç† React çŠ¶æ€çš„é»˜è®¤é€‰æ‹©ã€‚åªæœ‰å½“ä½ å¼€å§‹åœ¨ä½¿ç”¨ useState é‡åˆ°éº»çƒ¦æ—¶ï¼Œæ‰åˆ‡æ¢åˆ°useReducerï¼ˆå¦‚æœè¿™ä¸ªéº»çƒ¦å¯ä»¥é€šè¿‡åˆ‡æ¢åˆ° `useReducer` æ¥è§£å†³ï¼‰ã€‚è‡³å°‘åœ¨ä½ å¯¹useReduceræœ‰è¶³å¤Ÿçš„ç»éªŒï¼Œå¯ä»¥æå‰çŸ¥é“ä½¿ç”¨å“ªä¸€ä¸ªã€‚

æˆ‘å°†é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ä½•æ—¶ä½¿ç”¨useReducerè€Œä¸æ˜¯useStateã€‚

### äº’ç›¸ä¾èµ–çš„å¤šä¸ªçŠ¶æ€ç‰‡æ®µ

`useReducer` çš„ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹æ˜¯å½“ä½ æœ‰å¤šä¸ªç›¸äº’ä¾èµ–çš„çŠ¶æ€æ—¶ã€‚

è¿™åœ¨ä½ æ„å»ºè¡¨å•æ—¶å¾ˆå¸¸è§ã€‚æ¯”æ–¹è¯´ï¼Œä½ æœ‰ä¸€ä¸ªæ–‡æœ¬è¾“å…¥ï¼Œä½ æƒ³è·Ÿè¸ªä¸‰ä»¶äº‹ã€‚

1. è¾“å…¥çš„å€¼ã€‚
2. è¾“å…¥æ˜¯å¦å·²ç»è¢«ç”¨æˆ·â€œæ¥è§¦â€è¿‡ã€‚è¿™å¯¹äº†è§£æ˜¯å¦æ˜¾ç¤ºé”™è¯¯å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿™ä¸ªå­—æ®µæ˜¯å¿…å¡«çš„ï¼Œä½ æƒ³åœ¨å®ƒæ˜¯ç©ºçš„æ—¶å€™æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ã€‚ç„¶è€Œï¼Œå½“ç”¨æˆ·ä»¥å‰ä»æœªè®¿é—®è¿‡è¯¥è¾“å…¥æ—¶ï¼Œä½ ä¸å¸Œæœ›åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ã€‚
3. æ˜¯å¦æœ‰é”™è¯¯ã€‚

ä½¿ç”¨ `useState` ï¼Œä½ å¿…é¡»ä½¿ç”¨ä¸‰æ¬¡é’©å­ï¼Œæ¯æ¬¡æœ‰å˜åŒ–éƒ½è¦åˆ†åˆ«æ›´æ–°ä¸‰å—çŠ¶æ€ã€‚

ä½¿ç”¨ `useReducer` ï¼Œé€»è¾‘å…¶å®å¾ˆç®€å•ã€‚

```jsx
import { useReducer } from 'react';

const initialValue = {
  value: '',
  touched: false,
  error: null,
};

const reducer = (state, { type, payload }) => {
  switch (type) {
    case 'update':
      return {
        value: payload.value,
        touched: true,
        error: payload.error,
      };
    case 'reset':
      return initialValue;
    default:
      throw new Error(`Unknown action type: ${type}`);
  }
};

const Form = () => {
  const [state, dispatch] = useReducer(reducer, initialValue);
  console.log(state);
  return (
    <div>
      <input
        className={state.error ? 'error' : ''}
        value={state.value}
        onChange={(event) =>
          dispatch({
            type: 'update',
            payload: {
              value: event.target.value,
              error: state.touched ? event.target.value.length === 0 : null,
            },
          })
        }
      />
      <button onClick={() => dispatch({ type: 'reset' })}>reset</button>
    </div>
  );
};

export default Form;
```

æ·»åŠ ä¸€ç‚¹åŸºæœ¬çš„CSSæ¥è®¾è®¡é”™è¯¯ç±»ï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªå…·æœ‰è‰¯å¥½ç”¨æˆ·ä½“éªŒå’Œç®€å•é€»è¾‘çš„è¾“å…¥çš„å¼€å§‹ï¼Œè¿™è¦æ„Ÿè°¢ `useReducer` ã€‚

```css
.error {
  border-color: red;
}

.error:focus {
  outline-color: red;
}
```

![](https://devtrium.com/_next/image?url=%2Fhow-to-use-react-usereducer-hook%2Ftouched-form.gif&w=1080&q=100)

#### ç®¡ç†å¤æ‚çš„çŠ¶æ€

`useReducer`çš„å¦ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹æ˜¯ï¼Œå½“ä½ æœ‰å¾ˆå¤šä¸åŒçš„çŠ¶æ€ï¼Œè€ŒæŠŠå®ƒä»¬éƒ½æ”¾åœ¨useStateä¸­ä¼šå˜å¾—éå¸¸éš¾ä»¥æ§åˆ¶ã€‚

æˆ‘ä»¬åœ¨å‰é¢çœ‹åˆ°ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå•ä¸€çš„ `action` ç”¨åŒä¸€ä¸ª `action` ç®¡ç†ä¸¤ä¸ªè¾“å…¥ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†è¿™ä¸ªä¾‹å­æ‰©å±•åˆ°4ä¸ªè¾“å…¥ã€‚

å½“æˆ‘ä»¬è¿™æ ·åšçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ¯ä¸ªè¾“å…¥çš„åŠ¨ä½œé‡æ„å‡ºæ¥ã€‚

```jsx
import { useReducer } from 'react';

const initialValue = {
  firstName: '',
  lastName: '',
  username: '',
  email: '',
};

const reducer = (state, action) => {
  switch (action.type) {
    case 'update':
      return {
        ...state,
        [action.payload.key]: action.payload.value,
      };
    default:
      throw new Error(`Unknown action type: ${action.type}`);
  }
};

const Form = () => {
  const [state, dispatch] = useReducer(reducer, initialValue);

  const inputAction = (event) => {
    dispatch({
      type: 'update',
      payload: { key: event.target.name, value: event.target.value },
    });
  };

  return (
    <div>
      <input
        value={state.firstName}
        type="text"
        name="firstName"
        onChange={inputAction}
      />
      <input
        value={state.lastName}
        type="text"
        name="lastName"
        onChange={inputAction}
      />
      <input
        value={state.username}
        type="text"
        onChange={inputAction}
        name="username"
      />
      <input
        value={state.email}
        type="email"
        name="email"
        onChange={inputAction}
      />
    </div>
  );
};

export default Form;
```

è®²çœŸçš„ï¼Œè¿™æ®µä»£ç æ˜¯å¤šä¹ˆçš„å¹²å‡€å’Œæ¸…æ™°ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œç”¨4ä¸ªuseStateæ¥åšè¿™ä»¶äº‹å§! å¥½å§ï¼Œå®ƒä¸ä¼šé‚£ä¹ˆç³Ÿç³•ï¼Œä½†è¿™å¯ä»¥æ‰©å±•åˆ°ä½ æƒ³è¦çš„è¾“å…¥æ•°é‡ï¼Œè€Œä¸éœ€è¦æ·»åŠ ä»»ä½•å…¶ä»–ä¸œè¥¿ï¼Œé™¤äº†è¾“å…¥æœ¬èº«ã€‚

è€Œä¸”ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥å‘å±•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³æŠŠä¸Šä¸€èŠ‚çš„ `touched` å’Œ `error` å±æ€§æ·»åŠ åˆ°æœ¬èŠ‚çš„å››ä¸ªè¾“å…¥ä¸­çš„æ¯ä¸€ä¸ªã€‚

äº‹å®ä¸Šï¼Œæˆ‘å»ºè®®ä½ è‡ªå·±å°è¯•ä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»ƒä¹ ï¼Œå¯ä»¥å·©å›ºä½ åˆ°ç›®å‰ä¸ºæ­¢çš„å­¦ä¹ æˆæœã€‚

#### å¦‚æœç”¨useStateæ¥ä»£æ›¿è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿ

æ‘†è„±ä¸€æ‰“ `useState` è¯­å¥çš„æ–¹æ³•ä¹‹ä¸€æ˜¯æŠŠä½ æ‰€æœ‰çš„çŠ¶æ€æ”¾åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªuseStateä¸­ï¼Œç„¶åå†æ›´æ–°å®ƒã€‚

è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”æœ‰æ—¶å®ƒæ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚ä½†ä½ ç»å¸¸ä¼šå‘ç°è‡ªå·±ä»¥ä¸€ç§æ›´ç¬¨æ‹™çš„æ–¹å¼é‡æ–°å®ç°ä¸€ä¸ª `useReducer` ã€‚è¿˜ä¸å¦‚é©¬ä¸Šä½¿ç”¨ä¸€ä¸ª `reducer`ã€‚

### ä½¿ç”¨ TypeScript çš„ useReducer

å¥½äº†ï¼Œä½ ç°åœ¨åº”è¯¥å·²ç»æŒæ¡äº† `useReducer` çš„æŠ€å·§ã€‚å¦‚æœä½ æ˜¯ `TypeScript` çš„ä½¿ç”¨è€…ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“å¦‚ä½•æ­£ç¡®åœ°è®©è¿™ä¸¤è€…å‘æŒ¥å¾—æ›´å¥½ã€‚

å¹¸å¥½è¿™å¾ˆå®¹æ˜“ã€‚åœ¨è¿™é‡Œï¼Œå®ƒæ˜¯è¿™æ ·çš„ï¼š

```jsx
import { useReducer, ChangeEvent } from 'react';

type State = {
  firstName: string;
  lastName: string;
  username: string;
  email: string;
};

type Action =
  | {
      type: 'update';
      payload: {
        key: string;
        value: string;
      };
    }
  | { type: 'reset' };

const initialValue = {
  firstName: '',
  lastName: '',
  username: '',
  email: '',
};

const reducer = (state: State, action: Action) => {
  switch (action.type) {
    case 'update':
      return { ...state, [action.payload.key]: action.payload.value };
    case 'reset':
      return initialValue;
    default:
      throw new Error(`Unknown action type: ${action.type}`);
  }
};

const Form = () => {
  const [state, dispatch] = useReducer(reducer, initialValue);

  const inputAction = (event: ChangeEvent<HTMLInputElement>) => {
    dispatch({
      type: 'update',
      payload: { key: event.target.name, value: event.target.value },
    });
  };

  return (
    <div>
      <input
        value={state.firstName}
        type="text"
        name="firstName"
        onChange={inputAction}
      />
      <input
        value={state.lastName}
        type="text"
        name="lastName"
        onChange={inputAction}
      />
      <input
        value={state.username}
        type="text"
        onChange={inputAction}
        name="username"
      />
      <input
        value={state.email}
        type="email"
        name="email"
        onChange={inputAction}
      />
    </div>
  );
};

export default Form;
```

å¦‚æœä½ ä¸ç†Ÿæ‚‰ `Action` ç±»å‹çš„è¯­æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ª [æ­§è§†æ€§çš„è”åˆ](https://www.typescriptlang.org/docs/handbook/unions-and-intersections.html#discriminating-unions)ã€‚

## Reduxï¼šä¸€ä¸ªè¶…çº§å¼ºå¤§çš„ useReducer

æˆ‘ä»¬çš„ `useReducer` æŒ‡å—å°±è¦ç»“æŸäº†ï¼ˆå‘¼ï¼Œå®ƒæ¯”æˆ‘é¢„æœŸçš„è¦é•¿ï¼ï¼‰ã€‚è¿˜æœ‰ä¸€ä»¶é‡è¦çš„äº‹æƒ…è¦æåˆ°ï¼š[Redux](https://redux.js.org/)ã€‚

ä½ å¯èƒ½å¬è¯´è¿‡ `Redux` è¿™ä¸ªéå¸¸æµè¡Œçš„çŠ¶æ€ç®¡ç†åº“ã€‚æœ‰äº›äººè®¨åŒå®ƒï¼Œæœ‰äº›äººå–œæ¬¢å®ƒã€‚ä½†äº‹å®è¯æ˜ï¼Œä½ æ‰€æœ‰ç”¨äºç†è§£ `useReducer` æ‰€ç»å°½çš„è„‘æ±å¯¹ç†è§£ `Redux` æ˜¯æœ‰ç”¨çš„ï¼

äº‹å®ä¸Šï¼Œä½ å¯ä»¥æŠŠ `Redux` çœ‹ä½œæ˜¯æ•´ä¸ªåº”ç”¨çš„ä¸€ä¸ªå¤§çš„ã€å…¨å±€çš„ã€ç®¡ç†çš„å’Œä¼˜åŒ–çš„ `useReducer` ã€‚è¿™å°±æ˜¯å®ƒçš„å…¨éƒ¨ã€‚

ä½ æœ‰ä¸€ä¸ª â€œå­˜å‚¨â€ï¼š`store`ï¼Œå…¶ä¸­æœ‰ä½ çš„çŠ¶æ€ `state`ã€ä½ å®šä¹‰çš„åŠ¨ä½œ `action`ï¼Œå‘Šè¯‰ `reducer` å¦‚ä½•ä¿®æ”¹è¿™ä¸ªå­˜å‚¨ã€‚æ˜¯ä¸æ˜¯å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Ÿâ†–(^Ï‰^)â†—

å½“ç„¶è¿˜æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ï¼Œä½†å¦‚æœä½ å·²ç»å¾ˆå¥½åœ°ç†è§£äº† `useReducer` ï¼Œä½ å°±å¯ä»¥å¾ˆå¥½åœ°ç†è§£ Redux äº†ã€‚

## æ€»ç»“

è¿™å°±æ˜¯æ–‡ç« çš„ç»“å°¾! æˆ‘å¸Œæœ›å®ƒèƒ½å¸®åŠ©ä½ äº†è§£ä½ æƒ³è¦çš„å…³äºuseReducerçš„ä¸€åˆ‡ã€‚

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå®ƒå¯ä»¥æˆä¸ºä½ çš„ React å·¥å…·ç®±ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ã€‚

ç¥æ‚¨å¥½è¿!

ã€ç‰ˆæƒä¿¡æ¯ï¼šè‘—ä½œæƒå½’ devtrium.com æ‰€æœ‰ï¼Œå¦‚éœ€è½¬è½½æœ¬æ–‡ï¼Œè¯·æ³¨æ˜ä½œè€… `devtrium.com` å’Œè¯‘è€… `Ucely åˆ˜ä¿Š`ã€‚ã€‘